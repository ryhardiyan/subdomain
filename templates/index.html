<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Create Subdomain Free</title>
   <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-900 min-h-screen text-white">
   <div class="container mx-auto px-4 py-12">
       <div class="text-center mb-12">
           <h1 class="text-4xl font-bold mb-4">
               <i class="fas fa-globe mr-2"></i> Free Subdomain Creator
           </h1>
           <p class="text-gray-400">Quickly create your own subdomain for free.</p>
       </div>

       <div class="max-w-xl mx-auto bg-gray-800 p-8 rounded-xl shadow-lg">
           <form id="subdomainForm" class="space-y-6">
               <div>
                   <label class="block mb-1 font-medium">Subdomain</label>
                   <input type="text" id="subdomain" required class="w-full p-3 bg-gray-700 rounded focus:outline-none focus:ring focus:ring-blue-500" placeholder="e.g. mysub">
               </div>

               <div>
                   <label class="block mb-1 font-medium">Domain</label>
                   <select id="domain" required class="w-full p-3 bg-gray-700 rounded focus:outline-none focus:ring focus:ring-blue-500">
                       <option value="">Select domain</option>
                   </select>
               </div>

               <div>
                   <label class="block mb-1 font-medium">Record Type</label>
                   <select id="type" required class="w-full p-3 bg-gray-700 rounded focus:outline-none focus:ring focus:ring-blue-500">
                       <option value="A">A</option>
                       <option value="CNAME">CNAME</option>
                       <option value="TXT">TXT</option>
                   </select>
               </div>

               <div>
                   <label class="block mb-1 font-medium">Content / IP</label>
                   <input type="text" id="content" required class="w-full p-3 bg-gray-700 rounded focus:outline-none focus:ring focus:ring-blue-500" placeholder="e.g. 1.2.3.4 or cname.target.com">
               </div>

               <div class="flex items-center">
                   <input type="checkbox" id="proxied" class="mr-2">
                   <label for="proxied">Enable Cloudflare Proxy</label>
               </div>

               <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded font-bold">Create Subdomain</button>
           </form>

           <div id="result-container" class="mt-6"></div>
       </div>
   </div>

<script>
   document.addEventListener('DOMContentLoaded', function() {
       const domains = {{ domains|tojson|safe }};
       const domainSelect = document.getElementById('domain');
       domains.forEach(domain => {
           const option = document.createElement('option');
           option.value = domain;
           option.textContent = domain;
           domainSelect.appendChild(option);
       });

       document.getElementById('subdomainForm').addEventListener('submit', async (e) => {
           e.preventDefault();

           const data = {
               subdomain: document.getElementById('subdomain').value,
               domain: document.getElementById('domain').value,
               type: document.getElementById('type').value,
               content: document.getElementById('content').value,
               proxied: document.getElementById('proxied').checked
           };

           try {
               const response = await fetch('/create_subdomain', {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify(data)
               });

               const result = await response.json();

               if (result.success) {
                   if (result.redirect) {
                       window.location.href = result.redirect;
                   } else {
                       document.getElementById('result-container').innerHTML = '<p class="text-green-400">Subdomain created successfully!</p>';
                   }
               } else {
                   document.getElementById('result-container').innerHTML = `<p class="text-red-400">Error: ${result.message}</p>`;
               }
           } catch (err) {
               document.getElementById('result-container').innerHTML = '<p class="text-red-400">Something went wrong.</p>';
           }
       });
   });
</script>
</body>
</html>
