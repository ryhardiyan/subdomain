<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Subdomain Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Welcome, {{ user }}</h1>
      <a href="/logout" class="text-sm bg-red-500 hover:bg-red-600 px-4 py-2 rounded">Logout</a>
    </div>

    <div class="bg-gray-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-semibold mb-4">Your Subdomains</h2>

      {% if records %}
        <div class="space-y-6">
          {% for r in records %}
            <form class="bg-gray-700 p-4 rounded space-y-3" onsubmit="return updateRecord(event, '{{ r.name }}')">
              <input type="hidden" name="old_name" value="{{ r.name }}">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm mb-1">Subdomain</label>
                  <input name="name" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="{{ r.name }}" required>
                </div>
                <div>
                  <label class="block text-sm mb-1">Content / IP</label>
                  <input name="content" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="{{ r.content }}" required>
                </div>
                <div>
                  <label class="block text-sm mb-1">Type</label>
                  <select name="type" class="w-full p-2 rounded bg-gray-800 border border-gray-600">
                    <option value="A" {% if r.type == 'A' %}selected{% endif %}>A</option>
                    <option value="CNAME" {% if r.type == 'CNAME' %}selected{% endif %}>CNAME</option>
                    <option value="TXT" {% if r.type == 'TXT' %}selected{% endif %}>TXT</option>
                  </select>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" name="proxied" value="true" class="mr-2" {% if r.proxied %}checked{% endif %}>
                  <label>Use Proxy</label>
                </div>
              </div>
              <div class="mt-4 text-right">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm font-semibold">Save</button>
              </div>
            </form>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-400">No subdomains found.</p>
      {% endif %}
    </div>
  </div>

  <script>
    async function updateRecord(event, oldName) {
      event.preventDefault();
      const form = event.target;
      const data = {
        old_name: oldName,
        name: form.name.value,
        content: form.content.value,
        type: form.type.value,
        proxied: form.proxied.checked
      };

      const res = await fetch('/update_record', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      if (result.success) {
        alert('Record updated successfully.');
        location.reload();
      } else {
        alert('Failed to update record: ' + result.message);
      }
    }
  </script>
</body>
</html>